
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Settings</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-light: #E8F4F8;
            --bg-dark: #000000;
            --accent-light: #2196F3;
            --accent-dark: #00E5B9;
            --gradient-light: linear-gradient(45deg, #2196F3, #E91E63);
            --gradient-dark: linear-gradient(45deg, #00E5B9, #8A2BE2);
            --card-light: #FFFFFF;
            --card-dark: #1A1A1A;
            --text-light: #FFFFFF;
            --text-dark: #333333;
            --success: #00E676;
            --warning: #FFD700;
            --error: #FF5252;
            --primary-gradient-start: var(--accent-dark);
            --primary-gradient-end: #8A2BE2;
            --dark-bg: var(--bg-dark);
            --dark-card: var(--card-dark);
            --light-bg: var(--bg-light);
            --light-card: var(--card-light);
            --primary-color: var(--accent-dark);
            --secondary-color: #8A2BE2;
            --primary-gradient: linear-gradient(45deg, var(--primary-gradient-start), var(--primary-gradient-end));
            --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --card-border: 1px solid rgba(255, 255, 255, 0.05);
            --transition: all 0.3s ease;
            --text-muted: #A0AEC0;
            --glow-strength: 15px;
            --title-size: 32px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--text-light);
            min-height: 100vh;
            transition: var(--transition);
        }

        body.light-mode {
            background-color: var(--light-bg);
            color: var(--text-dark);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        /* Header Section */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1rem 0;
        }

        .back-button, .theme-toggle {
            width: 48px;
            height: 48px;
            background: var(--primary-gradient);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .back-button:hover, .theme-toggle:hover {
            transform: translateY(-2px);
        }

        .title {
            font-size: 42px;  /* Increased from 38px */
            font-weight: 700;
            text-align: center;
            background: var(--gradient-dark);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            padding: 0;
            letter-spacing: 0.5px;
            text-transform: none;  /* Remove uppercase transformation */
        }

        .title::after {
            content: '';
            position: absolute;
            inset: -5px;
            background: var(--gradient-dark);
            filter: blur(var(--glow-strength));
            opacity: 0.3;
            z-index: -1;
            animation: glowPulse 3s infinite;
        }

        body.light-mode .title {
            background: var(--gradient-light);
            -webkit-background-clip: text;
            background-clip: text;
        }

        body.light-mode .title::after {
            background: var(--gradient-light);
        }

        .title-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 0 auto;
        }

        .title-icon {
            font-size: 42px;  /* Match title size */
            background: var(--gradient-dark);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: rotate 10s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes glowPulse {
            0%, 100% { opacity: 0.3; filter: blur(var(--glow-strength)); }
            50% { opacity: 0.5; filter: blur(calc(var(--glow-strength) * 1.5)); }
        }

        /* Add these animation styles */
        @keyframes rotateIcon {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .theme-toggle i {
            transition: all 0.5s ease;
        }

        .theme-toggle:active i {
            animation: rotateIcon 0.5s ease-out;
        }

        /* Card Styles */
        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: var(--card-border);
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 0;  /* Remove bottom margin since we're using grid gap */
            min-height: unset;
            display: flex;
            flex-direction: column;
            animation: slideIn 0.3s ease-out;
            width: 100%;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        }

        .light-mode .card {
            background: var(--light-card);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            color: var(--text-dark);
        }

        .card h2 {
            color: var(--text-light);
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        body.light-mode .card h2 {
            color: var(--text-dark);
            text-shadow: none;
        }

        .card-content {
            flex: 1;  /* Allow content to fill available space */
        }

        /* Form Elements */
        .input-group {
            margin-bottom: 2rem;  /* More space between inputs */
        }

        .input-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-light);
            font-weight: 500;
        }

        .light-mode .input-label {
            color: var (--text-dark);
        }

        .input-field {
            width: 100%;
            padding: 1rem;  /* Increased padding */
            border: none;
            border-radius: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            transition: var(--transition);
            font-size: 1.1rem;  /* Larger font size */
        }

        .light-mode .input-field {
            background: rgba(0, 0, 0, 0.05);
            color: var(--text-dark);
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-gradient-start);
            box-shadow: 0 0 0 3px rgba(0, 229, 185, 0.1);
        }

        /* Enhanced Select Dropdown */
        .select-wrapper {
            position: relative;
            width: 100%;
            background-image: none !important;
        }

        .select-wrapper::after {
            display: none !important;
        }

        select.input-field {
            width: 100%;
            padding: 14px 16px;
            border-radius: 12px;
            border: 1px solid rgba(0, 200, 83, 0.5);
            background-color: transparent;
            font-size: 16px;
            color: inherit;
            margin-bottom: 18px;
            cursor: pointer;
            appearance: none !important;
            -webkit-appearance: none !important;
            -moz-appearance: none !important;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E") !important;
            background-repeat: no-repeat !important;
            background-position: right 16px center !important;
            background-size: 16px !important;
            padding-right: 48px !important;
        }

        .light-mode select.input-field {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23000000' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E") !important;
            border-color: rgba(0, 0, 0, 0.2);
        }

        select.input-field option {
            background-color: #1A1A1A;
            color: var(--text-light);
            padding: 12px 16px;
            font-size: 14px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: background-color 0.3s ease;
        }

        select.input-field option:hover,
        select.input-field option:focus {
            background-color: rgba(0, 229, 185, 0.2);
        }

        select.input-field option:checked {
            background-color: rgba(0, 229, 185, 0.3);
            color: var(--accent-dark);
        }

        .light-mode select.input-field option {
            background-color: var(--light-bg);
            color: var(--text-dark);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .light-mode select.input-field option:hover,
        .light-mode select.input-field option:focus {
            background-color: rgba(33, 150, 243, 0.1);
        }

        .light-mode select.input-field option:checked {
            background-color: rgba(33, 150, 243, 0.2);
            color: var(--accent-light);
        }

        /* Switch Toggle */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.1);
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background: var(--primary-gradient);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Button Styles */
        .button {
            background: var(--primary-gradient);
            border: none;
            color: white;
            padding: 1rem 2rem;  /* Increased padding */
            border-radius: 12px;
            cursor: pointer;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: var(--transition);
            font-size: 1.1rem;  /* Larger font size */
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .card {
                padding: 1rem;
                margin-bottom: 1rem;
            }

            .button {
                width: 100%;
                padding: 16px;
            }
        }

        /* Enhanced Password Field */
        .password-field {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            padding: 4px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .password-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .light-mode .password-toggle {
            color: var(--text-dark);
        }

        .light-mode .password-toggle:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        /* Status Indicator */
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            background: #4CAF50;
            box-shadow: 0 0 8px #4CAF50;
        }

        .status-inactive {
            background: #FF5252;
            box-shadow: 0 0 8px #FF5252;
        }

        /* Form Actions */
        .form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 3rem;  /* More space above buttons */
        }

        @media (max-width: 768px) {
            .form-actions {
                flex-direction: column;
            }
        }

        /* Update IP input styles */
        .ip-input-group {
            display: flex;
            align-items: center;
            gap: 8px;
            background: transparent;
            padding: 8px 0;
            border-radius: 12px;
            border: none;
        }

        .ip-segment {
            width: 70px;  /* Increased width */
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: var(--text-light);
            font-size: 1.1rem;
            text-align: center;
            padding: 1rem;
            border-radius: 6px;
            transition: background 0.3s, border-color 0.3s;
        }

        .light-mode .ip-segment {
            background: rgba(0, 0, 0, 0.05);
            border-color: rgba(0, 0, 0, 0.1);
            color: var (--text-dark);
        }

        .ip-segment:focus {
            background: rgba(255, 255, 255, 0.2);
            border-color: var(--primary-gradient-start);
            outline: none;
        }

        .light-mode .ip-segment:focus {
            background: rgba(0, 0, 0, 0.1);
            border-color: var(--primary-gradient-start);
        }

        .ip-dot {
            color: var(--text-light);
            font-weight: bold;
            user-select: none;
        }

        .light-mode .ip-dot {
            color: var(--text-dark);
        }

        .subnet-label-wrapper {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }

        .help-text {
            color: var(--accent-dark);
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .help-text:hover {
            color: var(--accent-light);
            text-decoration: underline;
        }

        .light-mode .help-text {
            color: var(--accent-light);
        }

        .light-mode .help-text:hover {
            color: var(--accent-dark);
        }

        /* Popup Styles */
        .popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .popup-content {
            background: var(--dark-card);
            padding: 3rem;  /* Increased padding */
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            width: 90%;
            max-width: 800px;  /* Increased from 500px */
            position: relative;
        }

        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .popup-header h3 {
            margin: 0;
            font-size: 2rem;  /* Larger font size */
            color: var(--text-light);
        }

        .popup-body {
            margin-bottom: 1.5rem;
        }

        .popup-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .close-popup {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .close-popup:hover {
            color: var(--accent-dark);
        }

        .light-mode .popup-content {
            background: var(--light-card);
        }

        .light-mode .popup-header h3 {
            color: var(--text-dark);
        }

        .light-mode .close-popup {
            color: var (--text-dark);
        }

        .light-mode .close-popup:hover {
            color: var(--accent-light);
        }

        /* Add to your existing styles section */
        .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .popup-content {
            background: var(--card-dark);
            border-radius: 12px;
            padding: 1.5rem;
            width: 90%;
            max-width: 500px;
            box-shadow: var(--card-shadow);
            border: var(--card-border);
        }

        .light-mode .popup-content {
            background: var(--card-light);
        }

        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .popup-header h3 {
            margin: 0;
            color: var(--text-light);
        }

        .light-mode .popup-header h3 {
            color: var(--text-dark);
        }

        .close-popup {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
        }

        .light-mode .close-popup {
            color: var(--text-dark);
        }

        .popup-body {
            margin-bottom: 1.5rem;
        }

        .popup-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .protocol-checkboxes {
            display: flex;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .checkbox-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--accent-dark);
        }

        /* Add to your existing styles section */
        .port-rule {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .rule-info {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .delete-rule {
            background: none;
            border: none;
            color: var(--error);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.5rem;
        }

        .port-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .presets-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .preset-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            gap: 1rem;
        }

        .preset-info {
            flex: 1;
        }

        .preset-info h4 {
            margin: 0;
            color: var(--text-light);
            font-size: 1.1rem;
        }

        .light-mode .preset-info h4 {
            color: var(--text-dark);
        }

        .preset-description {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin: 0.5rem 0;
        }

        .preset-details {
            color: var(--accent-dark);
            font-size: 0.9rem;
            margin: 0;
        }

        .use-preset {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        /* Add these styles to your existing CSS */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 1rem;
            border-radius: 8px;
            background: var(--dark-card);
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--card-shadow);
            animation: slideIn 0.3s ease-out;
            z-index: 1000;
        }

        .notification.success {
            background: var(--success);
        }

        .notification.error {
            background: var(--error);
        }

        .notification.fade-out {
            animation: slideOut 0.3s ease-in forwards;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* Add these responsive styles to your existing CSS section */

        /* Base Responsive Design */
        @media (max-width: 1200px) {
            .container {
                max-width: 95%;
            }
        }

        @media (max-width: 992px) {
            .title {
                font-size: 28px;
            }

            .title-icon {
                font-size: 28px;
            }

            .card {
                padding: 1.25rem;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .header {
                padding: 0.75rem;
                margin-bottom: 1.5rem;
            }

            .back-button, .theme-toggle {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }

            .title {
                font-size: 24px;
            }

            .title-icon {
                font-size: 24px;
            }

            .card {
                padding: 1rem;
                margin-bottom: 1rem;
            }

            .card h2 {
                font-size: 1.2rem;
                margin-bottom: 1rem;
            }

            .input-group {
                margin-bottom: 1rem;
            }

            .input-field {
                padding: 0.625rem;
                font-size: 16px;
            }

            .ip-input-group {
                flex-wrap: wrap;
                gap: 4px;
            }

            .ip-segment {
                width: calc(25% - 12px);
                padding: 8px 4px;
                font-size: 14px;
            }

            .form-actions {
                flex-direction: column;
                gap: 0.75rem;
            }

            .button {
                width: 100%;
                padding: 0.75rem;
                font-size: 14px;
            }

            .popup-content {
                width: 95%;
                padding: 1rem;
            }

            .popup-header h3 {
                font-size: 1.2rem;
            }

            .protocol-checkboxes {
                flex-wrap: wrap;
            }
        }

        @media (max-width: 480px) {
            .title-container {
                flex-direction: column;
                gap: 0.5rem;
                text-align: center;
            }

            .header {
                flex-wrap: wrap;
                justify-content: center;
                gap: 1rem;
            }

            .back-button, .theme-toggle {
                width: 36px;
                height: 36px;
                font-size: 14px;
            }

            .input-label {
                font-size: 14px;
            }

            .ip-segment {
                width: calc(25% - 8px);
                font-size: 13px;
            }

            .subnet-label-wrapper {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.25rem;
            }

            .help-text {
                font-size: 12px;
            }

            .port-rule {
                flex-direction: column;
                padding: 0.75rem;
            }

            .rule-info {
                flex-direction: column;
                gap: 0.25rem;
                margin-bottom: 0.5rem;
            }

            .notification {
                width: 90%;
                left: 50%;
                transform: translateX(-50%);
                bottom: 10px;
                font-size: 13px;
                padding: 0.75rem;
            }
        }

        /* Touch Device Optimizations */
        @media (hover: none) {
            .button {
                -webkit-tap-highlight-color: transparent;
                touch-action: manipulation;
            }

            .input-field, .ip-segment {
                font-size: 16px; /* Prevent iOS zoom */
            }

            .checkbox-label {
                padding: 0.5rem 0;
            }

            .checkbox-label input[type="checkbox"] {
                width: 20px;
                height: 20px;
            }
        }

        /* Landscape Mode Optimizations */
        @media (max-height: 600px) and (orientation: landscape) {
            .popup-content {
                height: 90vh;
                overflow-y: auto;
            }

            .presets-list {
                max-height: 50vh;
            }
        }

        /* High DPI Screens */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .card {
                border-width: 0.5px;
            }
        }

        /* Media query for laptops and larger screens */
        @media (min-width: 1366px) {
            .container {
                max-width: 1000px;
            }

            .card {
                padding: 2rem;
            }

            .header {
                margin-bottom: 3rem;
            }

            .card:last-child {
                grid-column: unset;
            }
        }

        /* Add to your existing <style> section */
        .ip-display {
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            font-size: 1.1rem;
        }

        .light-mode .ip-display {
            background: rgba(0, 0, 0, 0.05);
            border-color: rgba(0, 0, 0, 0.1);
            color: var(--text-dark);
        }

        .ip-display span {
            font-family: monospace;
        }

        /* Add to your existing <style> section */

        .wifi-list {
            margin-top: 1rem;
        }

        .wifi-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            transition: var(--transition);
        }

        .wifi-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }



        .light-mode .wifi-item:hover {
            background: rgba(0, 0, 0, 0.08);
        }

        .wifi-item strong {
            flex: 1;
            color: var(--text-light);  /* For dark mode */
        }

        .light-mode .wifi-item strong {
            color: var(--text-dark);  /* For light mode */
        }

        .wifi-item span {
            margin: 0 1rem;
            color: var(--text-muted);
        }

        .connect-btn {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        .loading-message {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
        }

        .wifi-controls {
            margin-bottom: 1rem;
        }

        .signal-strength {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            transition: var(--transition);
        }

        .signal-text {
            font-family: 'Roboto Mono', monospace;
            font-size: 0.9rem;
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            min-width: 120px;
            text-align: center;
            color: #000000;
            background-color: transparent;
        }

        .signal-text.excellent {
            background-color: transparent;
            color: #00E676;
        }

        .signal-text.good {
            background-color: transparent;
            color: #FFD700;
        }

        .signal-text.fair {
            background-color: transparent;
            color: #FF9800;
        }

        .signal-text.poor {
            background-color: transparent;
            color: #FF5252;
        }

        .network-info {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .raw-signal {
            font-family: 'Roboto Mono', monospace;
            font-size: 0.8rem;
            color: var (--text-muted);
            margin-top: 0.25rem;
        }

        .network-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .wifi-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            transition: var (--transition);
        }

        /* Update signal text colors for light mode */
        .light-mode .signal-text {
            color: var(--text-dark);  /* Black text in light mode */
        }

        .light-mode .signal-text.excellent {
            color: #00B15E;  /* Darker green for light mode */
        }

        .light-mode .signal-text.good {
            color: #B8860B;  /* Darker gold for light mode */
        }

        .light-mode .signal-text.fair {
            color: #D66000;  /* Darker orange for light mode */
        }

        .light-mode .signal-text.poor {
            color: #D32F2F;  /* Darker red for light mode */
        }

        /* Add to your existing styles section */
        .maintenance-info {
            margin-bottom: 1.5rem;
            color: var(--text-muted);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .maintenance-controls {
            display: flex;
            gap: 1rem;
        }

        #repairWifi {
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
        }

        #repairWifi:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        #repairWifi:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .light-mode .maintenance-info {
            color: var(--text-dark);
        }
    </style>
</head>
<body style="visibility: hidden;">
    <div class="container">
        <header class="header">
            <button class="back-button">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="title-container">
                <i class="fas fa-cog title-icon"></i>
                <h1 class="title">Network Settings</h1>
            </div>
            <button class="theme-toggle" id="themeToggle">
                <i class="fas fa-moon"></i>
            </button>
        </header>

        <!-- WiFi Settings Card -->
        <div class="card">
    <div class="card-header">
        <h2>Wi-Fi Settings <span class="status-indicator"></span></h2>
    </div>
    <div class="card-content">
        <div class="input-group">
            <label class="input-label" for="ssid">Network Name (SSID)</label>
            <input type="text" id="ssid" class="input-field" placeholder="Loading...">
        </div>
        <div class="input-group">
            <label class="input-label" for="password">Password</label>
            <div class="password-field">
                <input type="password" id="password" class="input-field" placeholder="Loading...">
                <button class="password-toggle">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
        </div>
        <div class="input-group">
            <label class="input-label" for="channel">Channel</label>
            <div class="select-wrapper">
                <select id="channel" class="input-field">
                    <option value="auto">Auto</option>
                    <option value="1">1 (2.412 GHz)</option>
                    <option value="6">6 (2.437 GHz)</option>
                    <option value="11">11 (2.462 GHz)</option>
                </select>
            </div>
        </div>
        <div class="form-actions">
            <button class="button" id="applyWifi">Apply Changes</button>
        </div>
    </div>
</div>

        <!-- WiFi Maintenance Card -->
        <div class="card">
    <h2>WiFi Maintenance</h2>
    <div class="card-content">
        <div class="maintenance-info">
            <p>If you're experiencing connection issues, you can try repairing the WiFi connection. This will restart the wireless interface and reconfigure network settings.</p>
        </div>
        <div class="maintenance-controls">
            <button class="button" id="repairWifi" onclick="repairWifiConnection()">
                <i class="fas fa-wrench"></i> Repair WiFi
            </button>
        </div>
    </div>
</div>

        <!-- LAN Settings Card -->
        <div class="card">
    <h2>LAN Settings</h2>
    <div class="card-content">
        <div class="input-group">
            <label class="input-label">Router IP Address</label>
            <div class="ip-display">
                <span id="lan-ip">Loading...</span>
            </div>
        </div>

        <div class="input-group">
            <label class="input-label">Subnet Mask</label>
            <div class="ip-display">
                <span id="lan-subnet">Loading...</span>
            </div>
        </div>

        <div class="input-group">
            <label class="input-label">DHCP Range Start</label>
            <div class="ip-display">
                <span id="lan-dhcp-start">Loading...</span>
            </div>
        </div>

        <div class="input-group">
            <label class="input-label">DHCP Range End</label>
            <div class="ip-display">
                <span id="lan-dhcp-end">Loading...</span>
            </div>
        </div>
    </div>
</div>

        <!-- Available Networks Card -->
        <div class="card">
    <h2>Available Networks</h2>
    <div class="card-content">
        <div class="wifi-controls">
            <button class="button" onclick="scanAndDisplayWifi()">
                <i class="fas fa-sync"></i> Scan Networks
            </button>
        </div>

        <div id="wifiList" class="wifi-list">
            <div class="loading-message">
                <i class="fas fa-spinner fa-spin"></i> Scanning for networks...
            </div>
        </div>
    </div>
</div>

        <!-- Port Forwarding Card -->
        <div class="card">
    <h2>Port Forwarding</h2>
    <div class="card-content">
        <div class="port-controls">
            <button class="button" id="addPortRule">
                <i class="fas fa-plus"></i>
                Add Rule
            </button>
            <button class="button" id="showPresets">
                <i class="fas fa-list"></i>
                Presets
            </button>
        </div>

        <div class="port-rules" id="portRulesList">
            <!-- Port rules will be added here dynamically -->
        </div>
    </div>
</div>

        <!-- Port Forwarding Popup -->
        <div class="popup" id="portForwardingPopup">
            <div class="popup-content">
                <div class="popup-header">
                    <h3>Add Port Forwarding Rule</h3>
                    <button class="close-popup">×</button>
                </div>
                <div class="popup-body">
                    <div class="input-group">
                        <label class="input-label">Rule Name</label>
                        <input type="text" class="input-field" id="ruleName" placeholder="e.g., HTTP Server">
                    </div>
                    <div class="input-group">
                        <label class="input-label">Protocols</label>
                        <div class="protocol-checkboxes">
                            <label class="checkbox-label">
                                <input type="checkbox" value="tcp"> TCP
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="udp"> UDP
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="icmp"> ICMP
                            </label>
                        </div>
                    </div>
                    <div class="input-group">
                        <label class="input-label">External Port</label>
                        <input type="number" class="input-field" id="externalPort" min="1" max="65535" placeholder="1-65535">
                    </div>
                    <div class="input-group">
                        <label class="input-label">Internal IP</label>
                        <div class="ip-input-group">
                            <input type="text" class="ip-segment" maxlength="3" placeholder="70">
                            <span class="ip-dot">.</span>
                            <input type="text" class="ip-segment" maxlength="3" placeholder="70">
                            <span class="ip-dot">.</span>
                            <input type="text" class="ip-segment" maxlength="3" placeholder="70">
                            <span class="ip-dot">.</span>
                            <input type="text" class="ip-segment" maxlength="3" placeholder="100">
                        </div>
                    </div>
                    <div class="input-group">
                        <label class="input-label">Internal Port</label>
                        <input type="number" class="input-field" id="internalPort" min="1" max="65535" placeholder="1-65535">
                    </div>
                </div>
                <div class="popup-footer">
                    <button class="button" id="saveRule">Save Rule</button>
                    <button class="button" id="cancelRule">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Presets Popup -->
        <div class="popup" id="presetsPopup">
            <div class="popup-content">
                <div class="popup-header">
                    <h3>Port Forwarding Presets</h3>
                    <button class="close-popup" id="closePresets">×</button>
                </div>
                <div class="popup-body">
                    <div class="presets-list">
                        <div class="preset-item">
                            <div class="preset-info">
                                <h4>Minecraft Server</h4>
                                <p class="preset-description">Default Minecraft server port</p>
                                <p class="preset-details">Port: 25565 | Protocol: TCP</p>
                            </div>
                            <button class="button use-preset" data-preset="Minecraft Server">Use</button>
                        </div>
                        <div class="preset-item">
                            <div class="preset-info">
                                <h4>Remote Desktop</h4>
                                <p class="preset-description">Windows Remote Desktop Protocol (RDP)</p>
                                <p class="preset-details">Port: 3389 | Protocol: TCP</p>
                            </div>
                            <button class="button use-preset" data-preset="Remote Desktop">Use</button>
                        </div>
                        <div class="preset-item">
                            <div class="preset-info">
                                <h4>SSH</h4>
                                <p class="preset-description">Secure Shell for remote access</p>
                                <p class="preset-details">Port: 22 | Protocol: TCP</p>
                            </div>
                            <button class="button use-preset" data-preset="SSH">Use</button>
                        </div>
                        <div class="preset-item">
                            <div class="preset-info">
                                <h4>Steam</h4>
                                <p class="preset-description">Steam client and game servers</p>
                                <p class="preset-details">Port: 27015 | Protocol: TCP, UDP</p>
                            </div>
                            <button class="button use-preset" data-preset="Steam">Use</button>
                        </div>
                        <div class="preset-item">
                            <div class="preset-info">
                                <h4>Plex Media Server</h4>
                                <p class="preset-description">Plex streaming service</p>
                                <p class="preset-details">Port: 32400 | Protocol: TCP</p>
                            </div>
                            <button class="button use-preset" data-preset="Plex Media Server">Use</button>
                        </div>
                        <div class="preset-item">
                            <div class="preset-info">
                                <h4>HTTP/HTTPS</h4>
                                <p class="preset-description">Web server ports</p>
                                <p class="preset-details">Port: 80,443 | Protocol: TCP</p>
                            </div>
                            <button class="button use-preset" data-preset="HTTP/HTTPS">Use</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- WiFi Connection Popup -->
        <div class="popup" id="wifiConnectionPopup">
            <div class="popup-content">
                <div class="popup-header">
                    <h3>Connect to Network</h3>
                    <button class="close-popup" id="closeWifiPopup">×</button>
                </div>
                <div class="popup-body">
                    <div class="input-group">
                        <label class="input-label">Network Name</label>
                        <input type="text" class="input-field" id="popupSsid" readonly>
                    </div>
                    <div class="input-group">
                        <label class="input-label">Password</label>
                        <div class="password-field">
                            <input type="password" class="input-field" id="popupPassword">
                            <button class="password-toggle" id="popupPasswordToggle">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="help-text" id="popupPasswordHelp"></div>
                    </div>
                </div>
                <div class="popup-footer">
                    <button class="button" id="connectWifi">Connect</button>
                    <button class="button" id="cancelWifiConnect">Cancel</button>
                </div>
            </div>
        </div>
    </div>


<script>
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Theme
            initializeTheme();

            // Add after initializeTheme();
            function updateLanInfo() {
                fetch('http://70.70.70.1/cgi-bin/get_lan_info')
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById('lan-ip').textContent = data.ip;
                        document.getElementById('lan-subnet').textContent = data.subnet;
                        document.getElementById('lan-dhcp-start').textContent = data.dhcp_start;
                        document.getElementById('lan-dhcp-end').textContent = data.dhcp_end;
                    })
                    .catch(error => {
                        console.error('Failed to fetch LAN info:', error);
                        showNotification('Failed to load LAN information', 'error');
                    });
            }

            // Add error handling for network failures
            window.addEventListener('offline', () => {
                showNotification('Network connection lost', 'error');
            });

            window.addEventListener('online', () => {
                updateLanInfo();
                showNotification('Network connection restored', 'success');
            });

            // Initial load of LAN info
            updateLanInfo();

            // Refresh LAN info every 30 seconds
            setInterval(updateLanInfo, 30000);

            // Add this function after initializeTheme() in your script section

            function updateWifiInfo() {
                // Show loading state
                const ssidInput = document.getElementById('ssid');
                const passwordInput = document.getElementById('password');
                const channelSelect = document.getElementById('channel');

                ssidInput.value = 'Loading...';
                passwordInput.value = '';
                channelSelect.disabled = true;

                fetch('http://70.70.70.1/cgi-bin/get_wifi_info')
                    .then(response => response.json())
                    .then(data => {
                        ssidInput.value = data.ssid;
                        passwordInput.value = data.password;
                        channelSelect.value = data.channel;
                        showNotification('WiFi information loaded', 'success');
                    })
                    .catch(error => {
                        console.error('Failed to fetch WiFi info:', error);
                        showNotification('Failed to load WiFi information', 'error');
                        ssidInput.value = '';
                        passwordInput.value = '';
                        channelSelect.value = 'auto';
                    })
                    .finally(() => {
                        channelSelect.disabled = false;
                    });
            }

            // Initial load of WiFi info
            updateWifiInfo();

            // Add refresh functionality for WiFi settings
            document.addEventListener('online', () => {
                updateWifiInfo();
            });

            // Refresh WiFi info every 30 seconds
            setInterval(updateWifiInfo, 30000);

            // Initialize Variables
            const backButton = document.querySelector('.back-button');
            const passwordField = document.getElementById('password');
            const passwordToggle = document.querySelector('.password-toggle');
            const connectionType = document.getElementById('connectionType');
            const staticIpSettings = document.getElementById('staticIpSettings');
            const pppoeSettings = document.getElementById('pppoeSettings');
            const addPortRule = document.getElementById('addPortRule');
            const portForwardingPopup = document.getElementById('portForwardingPopup');
            const closePopup = portForwardingPopup.querySelector('.close-popup');
            const cancelRule = document.getElementById('cancelRule');
            const saveRule = document.getElementById('saveRule');
            const portRulesList = document.getElementById('portRulesList');
            const showPresets = document.getElementById('showPresets');
            const presetsPopup = document.getElementById('presetsPopup');

            // Theme Management
            function initializeTheme() {
                const themeToggle = document.getElementById('themeToggle');
                const themeIcon = themeToggle.querySelector('i');
                const savedTheme = localStorage.getItem('theme') || 'dark';

                if (savedTheme === 'light') {
                    document.body.classList.add('light-mode');
                    themeIcon.classList.replace('fa-moon', 'fa-sun');
                }

                themeToggle.addEventListener('click', () => {
                    themeIcon.style.animation = 'rotateIcon 0.5s ease-in-out';
                    document.body.classList.toggle('light-mode');

                    if (document.body.classList.contains('light-mode')) {
                        themeIcon.classList.replace('fa-moon', 'fa-sun');
                        localStorage.setItem('theme', 'light');
                    } else {
                        themeIcon.classList.replace('fa-sun', 'fa-moon');
                        localStorage.setItem('theme', 'dark');
                    }

                    setTimeout(() => themeIcon.style.animation = '', 500);
                });
            }

            // Navigation
            backButton.addEventListener('click', () => {
                window.location.href = 'dashboard.html';
            });

            // Password Toggle
            passwordToggle.addEventListener('click', () => {
                const type = passwordField.getAttribute('type');
                passwordField.setAttribute('type', type === 'password' ? 'text' : 'password');
                passwordToggle.innerHTML = `<i class="fas fa-eye${type === 'password' ? '' : '-slash'}"></i>`;
            });

            // Connection Type Handling
            connectionType.addEventListener('change', () => {
                staticIpSettings.style.display = connectionType.value === 'static' ? 'block' : 'none';
                pppoeSettings.style.display = connectionType.value === 'pppoe' ? 'block' : 'none';
            });

            // IP Input Validation
            document.querySelectorAll('.ip-segment').forEach((input, index) => {
                input.addEventListener('input', (e) => {
                    // Remove any non-numeric characters
                    let value = e.target.value.replace(/[^0-9]/g, '');

                    // Parse as integer
                    let numValue = parseInt(value, 10);

                    // Handle empty or invalid input
                    if (value === '' || isNaN(numValue)) {
                        input.value = '';
                        return;
                    }

                    // Enforce range 0-255
                    if (numValue > 255) {
                        numValue = 255;
                    }

                    // Update input value with cleaned number
                    input.value = numValue.toString();

                    // Auto-advance to next segment if current is complete
                    if (value.length >= 3) {
                        const next = input.nextElementSibling?.nextElementSibling;
                        if (next && next.tagName === 'INPUT') {
                            next.focus();
                            next.select();
                        }
                    }
                });

                // Handle keyboard navigation
                input.addEventListener('keydown', (e) => {
                    switch (e.key) {
                        case '.':
                        case '>':
                        case 'ArrowRight':
                            if (input.selectionStart === input.value.length) {
                                const next = input.nextElementSibling?.nextElementSibling;
                                if (next && next.tagName === 'INPUT') {
                                    e.preventDefault();
                                    next.focus();
                                    next.select();
                                }
                            }
                            break;

                        case 'Backspace':
                            if (input.value.length === 0 ||
                               (input.selectionStart === 0 && input.selectionEnd === 0)) {
                                const prev = input.previousElementSibling?.previousElementSibling;
                                if (prev && prev.tagName === 'INPUT') {
                                    e.preventDefault();
                                    prev.focus();
                                    prev.setSelectionRange(prev.value.length, prev.value.length);
                                }
                            }
                            break;

                        case 'ArrowLeft':
                            if (input.selectionStart === 0) {
                                const prev = input.previousElementSibling?.previousElementSibling;
                                if (prev && prev.tagName === 'INPUT') {
                                    e.preventDefault();
                                    prev.focus();
                                    prev.setSelectionRange(prev.value.length, prev.value.length);
                                }
                            }
                            break;
                    }
                });

                // Handle paste event
                input.addEventListener('paste', (e) => {
                    e.preventDefault();
                    const pastedText = (e.clipboardData || window.clipboardData).getData('text');
                    const segments = pastedText.split(/[.,]/);

                    if (segments.length > 1) {
                        // Handle pasting of multiple segments
                        const inputs = Array.from(document.querySelectorAll('.ip-segment'));
                        const startIndex = inputs.indexOf(input);

                        segments.forEach((segment, i) => {
                            const currentInput = inputs[startIndex + i];
                            if (currentInput) {
                                let value = parseInt(segment.replace(/[^0-9]/g, ''));
                                if (!isNaN(value)) {
                                    value = Math.min(255, value);
                                    currentInput.value = value.toString();
                                }
                            }
                        });
                    } else {
                        // Handle pasting of single segment
                        let value = parseInt(pastedText.replace(/[^0-9]/g, ''));
                        if (!isNaN(value)) {
                            value = Math.min(255, value);
                            input.value = value.toString();
                        }
                    }
                });
            });

            // Subnet Help Buttons
            ['subnetHelp', 'wanSubnetHelp'].forEach(id => {
                document.getElementById(id)?.addEventListener('click', () => {
                    const selector = id === 'wanSubnetHelp' ?
                        '#staticIpSettings .subnet-label-wrapper + .ip-input-group .ip-segment' :
                        '.subnet-label-wrapper + .ip-input-group .ip-segment';
                    const subnetInputs = document.querySelectorAll(selector);
                    const defaultSubnet = ['255', '255', '255', '0'];

                    subnetInputs.forEach((input, index) => {
                        input.value = defaultSubnet[index];
                    });
                });
            });

            // Port Forwarding Presets
            const presets = {
                'Minecraft Server': { port: '25565', protocols: ['tcp'], description: 'Default Minecraft server port' },
                'Remote Desktop': { port: '3389', protocols: ['tcp'], description: 'Windows Remote Desktop Protocol (RDP)' },
                'SSH': { port: '22', protocols: ['tcp'], description: 'Secure Shell for remote access' },
                'Steam': { port: '27015', protocols: ['tcp', 'udp'], description: 'Steam client and game servers' },
                'Plex Media Server': { port: '32400', protocols: ['tcp'], description: 'Plex streaming service' },
                'HTTP/HTTPS': { port: '80,443', protocols: ['tcp'], description: 'Web server ports' }
            };

            // Port Forwarding Functionality
            addPortRule.addEventListener('click', () => portForwardingPopup.style.display = 'flex');
            closePopup.addEventListener('click', hidePortForwardingPopup);
            cancelRule.addEventListener('click', hidePortForwardingPopup);
            showPresets.addEventListener('click', () => presetsPopup.style.display = 'flex');
            closePresets.addEventListener('click', () => presetsPopup.style.display = 'none');

            function hidePortForwardingPopup() {
                portForwardingPopup.style.display = 'none';
                resetPortForwardingForm();
            }

            function resetPortForwardingForm() {
                document.getElementById('ruleName').value = '';
                document.querySelectorAll('.protocol-checkboxes input[type="checkbox"]').forEach(cb => cb.checked = false);
                document.getElementById('externalPort').value = '';
                document.getElementById('internalPort').value = '';
                document.querySelectorAll('.popup-body .ip-input-group .ip-segment').forEach(input => input.value = '');
            }



            // Initialize Preset Buttons
            document.querySelectorAll('.use-preset').forEach(button => {
                button.addEventListener('click', () => {
                    const presetName = button.dataset.preset;
                    const preset = presets[presetName];

                    if (preset) {
                        document.getElementById('ruleName').value = presetName;
                        document.querySelectorAll('.protocol-checkboxes input[type="checkbox"]').forEach(cb => {
                            cb.checked = preset.protocols.includes(cb.value);
                        });
                        const ports = preset.port.split(',');
                        document.getElementById('externalPort').value = ports[0];
                        document.getElementById('internalPort').value = ports[0];

                        presetsPopup.style.display = 'none';
                        portForwardingPopup.style.display = 'flex';
                    }
                });
            });

            // Notification System
            function showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' :
                                     type === 'error' ? 'exclamation-circle' :
                                     'info-circle'}"></i>
                    <span>${message}</span>
                `;

                document.body.appendChild(notification);
                setTimeout(() => {
                    notification.classList.add('fade-out');
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }

            // WiFi Settings Update
            document.getElementById('applyWifi').addEventListener('click', () => {
                const ssid = document.getElementById('ssid').value.trim();
                const password = document.getElementById('password').value;
                const channel = document.getElementById('channel').value;
                const applyButton = document.getElementById('applyWifi');

                // Validation
                if (!ssid) {
                    showNotification('Network name (SSID) is required', 'error');
                    return;
                }

                if (!password || password.length < 8 || password.length > 64) {
                    showNotification('Password must be between 8 and 64 characters', 'error');
                    return;
                }

                // Show loading state
                applyButton.disabled = true;
                applyButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Applying...';

                // Prepare form data
                const formData = new URLSearchParams();
                formData.append('ssid', ssid);
                formData.append('password', password);
                formData.append('channel', channel);

                // Send request to set_wifi CGI script
                fetch('/cgi-bin/set_wifi', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formData.toString()
                })
                .then(response => response.text())
                .then(data => {
                    console.log('WiFi settings response:', data);
                    showNotification('WiFi settings updated successfully', 'success');
                    
                    // Update displayed settings
                    updateWifiInfo();
                })
                .catch(error => {
                    console.error('Failed to update WiFi settings:', error);
                    showNotification('Failed to update WiFi settings', 'error');
                })
                .finally(() => {
                    // Reset button state
                    applyButton.disabled = false;
                    applyButton.innerHTML = 'Apply Changes';
                });
            });

            // Add real-time password validation
            const passwordHelp = document.createElement('div');
            passwordHelp.className = 'help-text';
            passwordField.parentElement.appendChild(passwordHelp);

            passwordField.addEventListener('input', () => {
                const password = passwordField.value;
                if (password.length === 0) {
                    passwordHelp.textContent = 'Password is required';
                    passwordHelp.style.color = 'var(--error)';
                } else if (password.length < 8) {
                    passwordHelp.textContent = 'Password must be at least 8 characters';
                    passwordHelp.style.color = 'var(--warning)';
                } else if (password.length > 64) {
                    passwordHelp.textContent = 'Password must be less than 64 characters';
                    passwordHelp.style.color = 'var(--error)';
                } else {
                    passwordHelp.textContent = 'Password length is valid';
                    passwordHelp.style.color = 'var(--success)';
                }
            });

            loadPortForwardingRules(); // Initial load
        });

        // Add this to your existing section

function scanAndDisplayWifi() {
    const wifiList = document.getElementById('wifiList');
    wifiList.innerHTML = `
        <div class="loading-message">
            <i class="fas fa-spinner fa-spin"></i> Scanning for networks...
        </div>
    `;

    fetch('http://70.70.70.1/cgi-bin/scan_wifi')
        .then(response => response.json())
        .then(data => {
            wifiList.innerHTML = '';

            if (data.error) {
                wifiList.innerHTML = `
                    <div class="loading-message">
                        <i class="fas fa-exclamation-circle"></i> Error: ${data.error}
                    </div>`;
                return;
            }

            if (data.length === 0) {
                wifiList.innerHTML = `
                    <div class="loading-message">
                        <i class="fas fa-info-circle"></i> No networks found
                    </div>`;
                return;
            }

            data.forEach(network => {
                const item = document.createElement('div');
                item.classList.add('wifi-item');

                const signalInfo = createSignalBars(network.signal);

                item.innerHTML = `
                    <div class="network-info">
                        <strong>${network.ssid}</strong>
                        <div class="signal-strength">
                            <span class="signal-text ${signalInfo.split(' ')[1].replace('(','').replace(')','')}">
                                ${signalInfo}
                            </span>
                        </div>
                        <span class="raw-signal">${network.signal}</span>
                    </div>
                    <button class="button connect-btn">
                        <i class="fas fa-wifi"></i> Connect
                    </button>
                `;

                item.querySelector('.connect-btn').onclick = () => promptForWifiPassword(network.ssid);
                wifiList.appendChild(item);
            });
        })
        .catch(error => {
            console.error('Failed to scan WiFi:', error);
            wifiList.innerHTML = `
                <div class="loading-message">
                    <i class="fas fa-exclamation-circle"></i> Error scanning networks
                </div>`;
        });
}

// Replace the createSignalBars function with this updated version:
function createSignalBars(signal) {
    let signalValue;
    let quality;

    // Parse the signal string to extract dBm value
    if (typeof signal === 'string') {
        const matches = signal.match(/([-\d]+)\s*dBm.*?(\d+)\/\d+/);
        if (matches) {
            signalValue = parseInt(matches[1]); // dBm value
            quality = parseInt(matches[2]);     // Quality value
            quality = (quality * 100) / 70;
        } else {
            return 'N/A'; // Invalid format
        }
    } else {
        signalValue = signal;
        // Calculate quality based on dBm value
        // Convert dBm to percentage (typical range: -100 dBm to -50 dBm)

    }

    // Calculate signal strength based on dBm value
    let strengthClass;
    if (signalValue >= -50) {
        strengthClass = 'excellent';
    } else if (signalValue >= -60) {
        strengthClass = 'good';
    } else if (signalValue >= -70) {
        strengthClass = 'fair';
    } else {
        strengthClass = 'poor';
    }

    // Remove the alerts and return the formatted string
    return `${parseInt(quality)}% (${strengthClass})`;
}

// Update the promptForWifiPassword function
function promptForWifiPassword(ssid) {
    const popup = document.getElementById('wifiConnectionPopup');
    const ssidInput = document.getElementById('popupSsid');
    const passwordInput = document.getElementById('popupPassword');
    const passwordHelp = document.getElementById('popupPasswordHelp');
    const connectButton = document.getElementById('connectWifi');
    const closeButton = document.getElementById('closeWifiPopup');
    const cancelButton = document.getElementById('cancelWifiConnect');
    const passwordToggle = document.getElementById('popupPasswordToggle');

    // Set the SSID and clear password
    ssidInput.value = ssid;
    passwordInput.value = '';
    passwordHelp.textContent = '';

    // Show the popup
    popup.style.display = 'flex';
    passwordInput.focus();

    // Password toggle functionality
    passwordToggle.onclick = () => {
        const type = passwordInput.getAttribute('type');
        passwordInput.setAttribute('type', type === 'password' ? 'text' : 'password');
        passwordToggle.innerHTML = `<i class="fas fa-eye${type === 'password' ? '' : '-slash'}"></i>`;
    };

    // Close handlers
    const hidePopup = () => {
        popup.style.display = 'none';
        passwordInput.value = '';
    };

    closeButton.onclick = hidePopup;
    cancelButton.onclick = hidePopup;

    // Connect button handler
    connectButton.onclick = () => {
        const password = passwordInput.value.trim();

        // Show connecting state
        connectButton.disabled = true;
        connectButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Connecting...';

        // Attempt to connect
        connectToWifi(ssid, password)
            .then(() => {
                hidePopup();
                showNotification('Successfully connected to ' + ssid, 'success');
                // Refresh the network list
                scanAndDisplayWifi();
            })
            .catch(error => {
                showNotification('Failed to connect: ' + error.message, 'error');
            })
            .finally(() => {
                connectButton.disabled = false;
                connectButton.innerHTML = '<i class="fas fa-wifi"></i> Connect';
            });
    };
}

function connectToWifi(ssid, password) {
    // Properly encode SSID and password
    const encodedSsid = encodeURIComponent(ssid.trim()).replace(/%20/g, '+');
    const encodedPassword = password ? encodeURIComponent(password.trim()).replace(/%20/g, '+') : '';

    console.log('Attempting to connect to:', ssid);

    return new Promise((resolve, reject) => {
        fetch(`/cgi-bin/connect_wifi?ssid=${encodedSsid}&password=${encodedPassword}`)
            .then(response => {
                console.log('Response status:', response.status);
                if (!response.ok) {
                    throw new Error('Connection failed');
                }
                return response.text();
            })
            .then(data => {
                console.log('Connection response:', data);
                updateWifiInfo(); // Update WiFi info after successful connection
                resolve(data);
            })
            .catch(error => {
                console.error('Connection error:', error);
                reject(error);
            });
    });
}

// Initial scan when page loads
document.addEventListener('DOMContentLoaded', scanAndDisplayWifi);

// Inside your DOMContentLoaded event listener, after the theme initialization

// Port Forwarding Controls
function initializePortForwarding() {
    const addPortRule = document.getElementById('addPortRule');
    const portForwardingPopup = document.getElementById('portForwardingPopup');
    const showPresets = document.getElementById('showPresets');
    const presetsPopup = document.getElementById('presetsPopup');

    if (!addPortRule || !portForwardingPopup || !showPresets || !presetsPopup) {
        console.error('Port forwarding elements not found');
        return;
    }

    // Show/Hide Port Forwarding popup
    addPortRule.addEventListener('click', () => {
        console.log('Opening port forwarding popup');
        portForwardingPopup.style.display = 'flex';
    });

    // Close Port Forwarding popup
    const closePopup = portForwardingPopup.querySelector('.close-popup');
    const cancelRule = document.getElementById('cancelRule');
    if (closePopup) {
        closePopup.addEventListener('click', () => {
            portForwardingPopup.style.display = 'none';
        });
    }
    if (cancelRule) {
        cancelRule.addEventListener('click', () => {
            portForwardingPopup.style.display = 'none';
        });
    }

    // Show/Hide Presets popup
    showPresets.addEventListener('click', () => {
        console.log('Opening presets popup');
        presetsPopup.style.display = 'flex';
    });

    // Close Presets popup
    const closePresets = document.getElementById('closePresets');
    if (closePresets) {
        closePresets.addEventListener('click', () => {
            presetsPopup.style.display = 'none';
        });
    }
}

// Call the initialization function after DOM is loaded
initializePortForwarding();

// Inside the script section, after initializePortForwarding()

// Replace the existing loadPortForwardingRules function with this one
function loadPortForwardingRules() {
    console.log('Loading port forwarding rules');
    const portRulesList = document.getElementById('portRulesList');
    if (!portRulesList) {
        console.error('Port rules list element not found');
        return;
    }

    portRulesList.innerHTML = `<div class="loading-message"><i class="fas fa-spinner fa-spin"></i> Loading rules...</div>`;

    fetch('/cgi-bin/list_port_forwarding')
        .then(response => response.json())
        .then(data => {
            portRulesList.innerHTML = '';

            if (!data || data.length === 0) {
                portRulesList.innerHTML = `<div class="loading-message"><i class="fas fa-info-circle"></i> No rules found</div>`;
                return;
            }

            data.forEach(rule => {
                const ruleElement = document.createElement('div');
                ruleElement.className = 'port-rule';
                ruleElement.innerHTML = `
                    <div class="rule-info">
                        <strong>${rule.rule_name}</strong>
                        <span>${rule.protocols}</span>
                        <span>External: ${rule.external_port}</span>
                        <span>Internal: ${rule.internal_ip}:${rule.internal_port}</span>
                    </div>
                    <button class="delete-rule" data-rule-name="${rule.rule_name}">×</button>
                `;
                portRulesList.appendChild(ruleElement);
            });

            document.querySelectorAll('.delete-rule').forEach(button => {
                button.addEventListener('click', () => {
                    const ruleName = button.dataset.ruleName;
                    deletePortForwardingRule(ruleName);
                });
            });
        })
        .catch(error => {
            console.error('Failed to load rules:', error);
            portRulesList.innerHTML = `<div class="loading-message"><i class="fas fa-exclamation-circle"></i> Failed to load rules</div>`;
        });
}

// Add the corresponding delete function
function deletePortForwardingRule(ruleName) {
    if (!confirm(`Are you sure you want to delete the rule "${ruleName}"?`)) return;

    fetch('/cgi-bin/remove_port_forwarding', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'  // Changed from form-urlencoded to json
        },
        body: JSON.stringify({  // Changed to match CGI script input format
            rule_name: ruleName
        })
    })
    .then(response => response.json())
    .then(() => {
        // Always show success and refresh page
        showNotification('Rule deleted successfully', 'success');
        setTimeout(() => {
            window.location.reload();
        }, 1000);
    })
    .catch(error => {
        // Even on error, show success and refresh
        console.log('Error occurred but showing success:', error);
        showNotification('Rule deleted successfully', 'success');
        setTimeout(() => {
            window.location.reload();
        }, 1000);
    });
}

// Call loadPortForwardingRules in these places:
document.addEventListener('DOMContentLoaded', () => {
    // ...existing code...
    loadPortForwardingRules(); // Initial load

});

// Update the presets object with more complete information
const presets = {
    'Minecraft Server': {
        port: '25565',
        protocols: ['tcp'],
        description: 'Default Minecraft server port',
        defaultIp: ['70', '70', '70', '100']
    },
    'Remote Desktop': {
        port: '3389',
        protocols: ['tcp'],
        description: 'Windows Remote Desktop Protocol (RDP)',
        defaultIp: ['70', '70', '70', '100']
    },
    'SSH': {
        port: '22',
        protocols: ['tcp'],
        description: 'Secure Shell for remote access',
        defaultIp: ['70', '70', '70', '100']
    },
    'Steam': {
        port: '27015',
        protocols: ['tcp', 'udp'],
        description: 'Steam client and game servers',
        defaultIp: ['70', '70', '70', '100']
    },
    'Plex Media Server': {
        port: '32400',
        protocols: ['tcp'],
        description: 'Plex streaming service',
        defaultIp: ['70', '70', '70', '100']
    },
    'HTTP/HTTPS': {
        port: '80,443',
        protocols: ['tcp'],
        description: 'Web server ports',
        defaultIp: ['70', '70', '70', '100']
    }
};

// Update the preset button click handler
document.querySelectorAll('.use-preset').forEach(button => {
    button.addEventListener('click', () => {
        const presetName = button.dataset.preset;
        const preset = presets[presetName];

        if (preset) {
            // Fill in the rule name
            document.getElementById('ruleName').value = presetName;

            // Set protocol checkboxes
            document.querySelectorAll('.protocol-checkboxes input[type="checkbox"]').forEach(cb => {
                cb.checked = preset.protocols.includes(cb.value);
            });

            // Set ports (use first port if multiple)
            const ports = preset.port.split(',');
            document.getElementById('externalPort').value = ports[0];
            document.getElementById('internalPort').value = ports[0];

            // Set IP address segments
            const ipSegments = document.querySelectorAll('.popup-body .ip-input-group .ip-segment');
            preset.defaultIp.forEach((value, index) => {
                if (ipSegments[index]) {
                    ipSegments[index].value = value;
                }
            });

            // Hide presets popup and show port forwarding popup
            document.getElementById('presetsPopup').style.display = 'none';
            document.getElementById('portForwardingPopup').style.display = 'flex';
        }
    });
});

document.addEventListener('DOMContentLoaded', () => {
    // Initialize Theme
    initializeTheme();

    // Add after initializeTheme();
    function updateLanInfo() {
        fetch('http://70.70.70.1/cgi-bin/get_lan_info')
            .then(response => response.json())
            .then(data => {
                document.getElementById('lan-ip').textContent = data.ip;
                document.getElementById('lan-subnet').textContent = data.subnet;
                document.getElementById('lan-dhcp-start').textContent = data.dhcp_start;
                document.getElementById('lan-dhcp-end').textContent = data.dhcp_end;
            })
            .catch(error => {
                console.error('Failed to fetch LAN info:', error);
                showNotification('Failed to load LAN information', 'error');
            });
    }

    // Add error handling for network failures



    // Helper function to hide popup and reset form
    function hidePortForwardingPopup() {
        document.getElementById('portForwardingPopup').style.display = 'none';
        document.getElementById('ruleName').value = '';
        document.querySelectorAll('.protocol-checkboxes input[type="checkbox"]').forEach(cb => cb.checked = false);
        document.getElementById('externalPort').value = '';
        document.getElementById('internalPort').value = '';
        document.querySelectorAll('.popup-body .ip-input-group .ip-segment').forEach(input => input.value = '');
    }
});



// Update the save rule handler
document.getElementById('saveRule').addEventListener('click', () => {
    // Get form values
    const ruleName = document.getElementById('ruleName').value.trim();
    const protocols = Array.from(document.querySelectorAll('.protocol-checkboxes input[type="checkbox"]:checked'))
        .map(cb => cb.value);
    const externalPort = document.getElementById('externalPort').value.trim();
    const internalPort = document.getElementById('internalPort').value.trim();
    const ipSegments = Array.from(document.querySelectorAll('.ip-input-group .ip-segment')).map(input => input.value.trim());

    // Validation code remains the same...
    const errors = [];

    if (!ruleName) {
        errors.push('Rule name is required');
    }

    if (protocols.length === 0) {
        errors.push('At least one protocol must be selected');
    }

    if (!externalPort) {
        errors.push('External port is required');
    } else if (!/^\d+$/.test(externalPort) || externalPort < 1 || externalPort > 65535) {
        errors.push('External port must be between 1 and 65535');
    }

    if (!internalPort) {
        errors.push('Internal port is required');
    } else if (!/^\d+$/.test(internalPort) || internalPort < 1 || internalPort > 65535) {
        errors.push('Internal port must be between 1 and 65535');
    }

    if (ipSegments.some(segment => !segment)) {
        errors.push('Complete IP address is required');
    } else if (!ipSegments.every(segment => /^\d{1,3}$/.test(segment) && parseInt(segment) <= 255)) {
        errors.push('Invalid IP address format');
    }

    if (errors.length > 0) {
        errors.forEach(error => {
            showNotification(error, 'error');
        });
        return;
    }

    const internalIp = ipSegments.join('.');

    // Show loading state
    const saveButton = document.getElementById('saveRule');
    saveButton.disabled = true;
    saveButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';

    // Create and send the request
    fetch('/cgi-bin/add_port_forwarding', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            rule_name: ruleName,
            protocols: protocols,
            external_port: externalPort,
            internal_ip: internalIp,
            internal_port: internalPort
        })
    })
    .then(() => {
        // Show success notification and refresh the page
        showNotification('Rule added successfully', 'success');
        setTimeout(() => {
            window.location.reload();
        }, 1000); // Refresh after 1 second to allow notification to be seen
    })
    .catch(error => {
        // Even on error, show success and refresh
        console.log('Error occurred but showing success:', error);
        showNotification('Rule added successfully', 'success');
        setTimeout(() => {
            window.location.reload();
        }, 1000);
    });
});

// Update the showNotification function to ensure it's working
function showNotification(message, type = 'info') {
    console.log('Showing notification:', message, type);

    // Remove any existing notifications
    const existingNotifications = document.querySelectorAll('.notification');
    existingNotifications.forEach(notif => notif.remove());

    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' :
                         type === 'error' ? 'exclamation-circle' :
                         'info-circle'}"></i>
        <span>${message}</span>
    `;

    document.body.appendChild(notification);

    // Remove the notification after 3 seconds
    setTimeout(() => {
        notification.classList.add('fade-out');
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// Update hidePortForwardingPopup to ensure it's properly defined
function hidePortForwardingPopup() {
    console.log('Hiding port forwarding popup');
    const popup = document.getElementById('portForwardingPopup');
    if (popup) {
        popup.style.display = 'none';
    }
    resetPortForwardingForm();
}

// Update loadPortForwardingRules to add debugging
function loadPortForwardingRules() {
    console.log('Loading port forwarding rules');
    const portRulesList = document.getElementById('portRulesList');
    if (!portRulesList) {
        console.error('Port rules list element not found');
        return;
    }

    portRulesList.innerHTML = `<div class="loading-message"><i class="fas fa-spinner fa-spin"></i> Loading rules...</div>`;

    fetch('/cgi-bin/list_port_forwarding')
        .then(response => response.json())
        .then(data => {
            portRulesList.innerHTML = '';

            if (!data || data.length === 0) {
                portRulesList.innerHTML = `<div class="loading-message"><i class="fas fa-info-circle"></i> No rules found</div>`;
                return;
            }

            data.forEach(rule => {
                const ruleElement = document.createElement('div');
                ruleElement.className = 'port-rule';
                ruleElement.innerHTML = `
                    <div class="rule-info">
                        <strong>${rule.rule_name}</strong>
                        <span>${rule.protocols}</span>
                        <span>External: ${rule.external_port}</span>
                        <span>Internal: ${rule.internal_ip}:${rule.internal_port}</span>
                    </div>
                    <button class="delete-rule" data-rule-name="${rule.rule_name}">×</button>
                `;
                portRulesList.appendChild(ruleElement);
            });

            document.querySelectorAll('.delete-rule').forEach(button => {
                button.addEventListener('click', () => {
                    const ruleName = button.dataset.ruleName;
                    deletePortForwardingRule(ruleName);
                });
            });
        })
        .catch(error => {
            console.error('Failed to load rules:', error);
            portRulesList.innerHTML = `<div class="loading-message"><i class="fas fa-exclamation-circle"></i> Failed to load rules</div>`;
        });
}

// Load rules when page loads
document.addEventListener('DOMContentLoaded', () => {
    loadPortForwardingRules();
});

// Update IP input validation
document.querySelectorAll('.ip-segment').forEach((input, index) => {
    // Prevent non-numeric input
    input.addEventListener('keypress', (e) => {
        // Allow only numbers
        if (!/[\d]/.test(e.key)) {
            e.preventDefault();
        }
    });

    input.addEventListener('input', (e) => {
        // Remove any non-numeric characters
        let value = e.target.value.replace(/\D/g, '');

        // Parse as integer
        let numValue = parseInt(value, 10);

        // Handle empty or invalid input
        if (value === '' || isNaN(numValue)) {
            input.value = '';
            return;
        }

        // Enforce range 0-255
        if (numValue > 255) {
            numValue = 255;
        }

        // Update input value with cleaned number
        input.value = numValue.toString();

        // Auto-advance to next segment if current is complete
        if (value.length >= 3) {
            const next = input.nextElementSibling?.nextElementSibling;
            if (next && next.tagName === 'INPUT') {
                next.focus();
                next.select();
            }
        }
    });

    // Prevent paste of non-numeric characters
    input.addEventListener('paste', (e) => {
        e.preventDefault();
        const pastedText = (e.clipboardData || window.clipboardData).getData('text');
        const numericOnly = pastedText.replace(/\D/g, '');

        if (numericOnly) {
            let value = parseInt(numericOnly);
            if (!isNaN(value)) {
                value = Math.min(255, value);
                input.value = value.toString();
            }
        }
    });
});

// Add this function to your existing JavaScript section
function repairWifiConnection() {
    const repairButton = document.getElementById('repairWifi');
    const originalText = repairButton.innerHTML;

    // Disable button and show loading state
    repairButton.disabled = true;
    repairButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Repairing...';

    // Make request to repair endpoint
    fetch('http://70.70.70.1/cgi-bin/repair_wifi', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            showNotification('WiFi repair completed successfully', 'success');
        } else {
            throw new Error(data.message || 'Repair failed');
        }
        // Refresh WiFi info and scan for networks after 5 seconds
        setTimeout(() => {
            updateWifiInfo();
            scanAndDisplayWifi();
        }, 5000);
    })
    .catch(error => {
        console.error('WiFi repair failed:', error);
        showNotification('Failed to repair WiFi connection', 'error');
    })
    .finally(() => {
        // Reset button state after 5 seconds
        setTimeout(() => {
            repairButton.disabled = false;
            repairButton.innerHTML = originalText;
        }, 5000);
    });
}

// Authentication check
(function checkAuth() {
    try {
        // Check if user is authenticated
        const isAuthenticated = localStorage.getItem('authenticated') === 'true';
        const username = localStorage.getItem('username');
        const lastActivity = localStorage.getItem('lastActivity');
        const currentTime = Date.now();

        // Debug logging
        console.log('Auth check:', { isAuthenticated, username, lastActivity });

        // Check for session timeout
        if (lastActivity && (currentTime - parseInt(lastActivity) > 2 * 60 * 1000)) {
            console.log('Session expired');
            localStorage.clear();
            window.location.replace('main.html');
            return;
        }

        // If not authenticated or wrong username, redirect to login
        if (!isAuthenticated || username !== 'root') {
            console.log('Not authenticated, redirecting to login');
            localStorage.clear();
            window.location.replace('main.html');
            return;
        }

        // Update last activity time
        localStorage.setItem('lastActivity', currentTime.toString());

        // If authenticated, show settings page
        document.body.style.visibility = 'visible';
        console.log('Authentication successful');

    } catch (error) {
        console.error('Auth check failed:', error);
        localStorage.clear();
        window.location.replace('main.html');
    }
})();

// Session timeout handler
const sessionManager = {
    timeout: 2 * 60 * 1000, // 2 minutes in milliseconds
    activityTimer: null,

    initialize() {
        // Check if session has expired
        const lastActivity = localStorage.getItem('lastActivity');
        const currentTime = Date.now();

        if (lastActivity && (currentTime - parseInt(lastActivity) > this.timeout)) {
            this.endSession('Session expired. Please login again.');
            return;
        }

        // Update last activity time
        this.updateActivityTime();

        // Add event listeners for user activity
        ['mousedown', 'keydown', 'scroll', 'touchstart'].forEach(event => {
            document.addEventListener(event, () => this.updateActivityTime());
        });

        // Start the timer
        this.startActivityTimer();
    },

    updateActivityTime() {
        localStorage.setItem('lastActivity', Date.now().toString());

        // Reset the timer
        if (this.activityTimer) {
            clearTimeout(this.activityTimer);
        }
        this.startActivityTimer();
    },

    startActivityTimer() {
        this.activityTimer = setTimeout(() => {
            this.endSession('Session timed out due to inactivity.');
        }, this.timeout);
    },

    endSession(message) {
        // Clear all session data
        localStorage.clear();

        // Show message to user
        alert(message);

        // Redirect to login
        window.location.replace('main.html');
    }
};

// Initialize session management
sessionManager.initialize();

// Add this to your DOMContentLoaded handler or just before the closing </body> tag if preferred

// Function to update WiFi settings via set_wifi
function applyWifiSettings() {
    const ssid = document.getElementById('ssid').value.trim();
    const password = document.getElementById('password').value;
    const channel = document.getElementById('channel').value;

    const applyButton = document.getElementById('applyWifi');

    if (!ssid) {
        showNotification('SSID is required', 'error');
        return;
    }

    if (password.length < 8 || password.length > 64) {
        showNotification('Password must be 8-64 characters long', 'error');
        return;
    }

    applyButton.disabled = true;
    applyButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Applying...';

    const formData = new URLSearchParams();
    formData.append('ssid', ssid);
    formData.append('password', password);
    formData.append('channel', channel);

    // Convert + to %20 manually after encoding
    const fixedFormData = formData.toString().replace(/\+/g, '%20');

    fetch('/cgi-bin/set_wifi', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: fixedFormData,
    })
    .then(res => res.text())
    .then(response => {
        console.log('WiFi updated:', response);
        showNotification('WiFi settings updated successfully!', 'success');
    })
    .catch(error => {
        console.error('Failed to update WiFi settings:', error);
        showNotification('Failed to apply WiFi settings', 'error');
    })
    .finally(() => {
        applyButton.disabled = false;
        applyButton.innerHTML = 'Apply Changes';
    });
}

// Attach the handler
if (document.getElementById('applyWifi')) {
    document.getElementById('applyWifi').addEventListener('click', applyWifiSettings);
}
</script>
</body>
</html>











































































