#!/bin/sh
echo "Content-Type: application/json"
echo ""

LEASES="/tmp/dhcp.leases"

if [ ! -f "$LEASES" ]; then
  echo "[]"
  exit 0
fi

echo "["
FIRST=true
while read -r line; do
  [ -z "$line" ] && continue
  set -- $line
  ts=$1 mac=$2 ip=$3 hostname=$4

  if [ "$FIRST" = false ]; then echo ","; fi
  echo -n "{\"mac\": \"${mac}\", \"hostname\": \"${hostname}\"}"
  FIRST=false
done < "$LEASES"
echo "]"
