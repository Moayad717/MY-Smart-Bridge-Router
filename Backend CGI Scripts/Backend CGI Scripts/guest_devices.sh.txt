#!/bin/sh
echo "Content-type: application/json"
echo ""

# Prepare JSON output
echo "{ \"devices\": ["

FIRST=1
# Filter DHCP leases for 70.70.71.x IP range (guest network)
grep "70\.70\.71\." /tmp/dhcp.leases | while read -r EXP MAC IP HOST ID; do
    [ "$FIRST" -eq 0 ] && echo ","
    echo "  { \"mac\": \"$MAC\", \"ip\": \"$IP\", \"hostname\": \"${HOST:-Unknown}\" }"
    FIRST=0
done

echo "] }"
