#!/bin/ash
echo "Content-type: text/plain"
echo ""

vpn_process=$(pgrep -af "openvpn --config")

if [ -n "$vpn_process" ]; then
    vpn_config=$(echo "$vpn_process" | awk '{for (i=1; i<=NF; i++) if ($i=="--config") print $(i+1)}')
    echo "VPN is running"
    echo "Connected to: $(basename "$vpn_config")"
else
    echo "VPN is not running"
fi

root@OpenWrt:/www/cgi-bin# cat usa-server
#!/bin/ash


killall openvpn 2>/dev/null
sleep 4
openvpn --config /etc/openvpn/usa.conf & disown
echo "Content-type: text/plain"
echo ""
echo "VPN USA started"
